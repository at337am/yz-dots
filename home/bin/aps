#!/usr/bin/env bash

# -=-=--=-=--=-=--=-=--=-=--=-=--=-=--=-=--=-=--=-=--=-=-
# 脚本用途：
# 该脚本用于将本地文件批量推送到通过 ADB 连接的 Android 设备。
# 功能说明：
# 1. 检查 ADB 设备是否已连接。
# 2. 在设备上创建目标目录 /sdcard/tmp_aps（如果不存在）。
# 3. 将指定的一个或多个本地文件上传到该目录。
# 4. 对每个文件提供进度提示，未找到的文件会输出错误信息。
# -=-=--=-=--=-=--=-=--=-=--=-=--=-=--=-=--=-=--=-=--=-=-

if ! command -v "adb" &> /dev/null; then
    printf "Error: 缺少依赖命令: adb\n" >&2
    exit 1
fi

if [[ "$#" -eq 0 ]]; then
    printf "参数错误\n" >&2
    printf "用法: %s <file>...\n" "aps" >&2
    exit 1
fi

if [[ -z "$(adb devices | tail -n +2 | grep -v '^$')" ]]; then
    printf "Error: 未检测到任何 ADB 连接的设备\n" >&2
    exit 1
fi

target_dir="/sdcard/tmp_aps"

if ! adb shell "mkdir -p '$target_dir'"; then
    printf "Error: 在 ADB 设备上创建目录 '%s' 失败\n" "$target_dir" >&2
    exit 1
fi

for source in "$@"; do
    if [[ -e "$source" ]]; then
        printf "\033[34mPushing '%s' to %s...\033[0m\n" "$source" "$target_dir"
        adb push "$source" "$target_dir"
    else
        printf "\033[31mError: '%s' does not exist\033[0m\n" "$source" >&2
    fi
done

printf "Done.\n"
