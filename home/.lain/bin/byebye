#!/usr/bin/env bash

# -=-=--=-=--=-=--=-=--=-=--=-=--=-=--=-=--=-=--=-=--=-=-
# 脚本用途: 关闭一些指定的进程, 并执行关机命令
# -=-=--=-=--=-=--=-=--=-=--=-=--=-=--=-=--=-=--=-=--=-=-

# 倒计时秒数
countdown=3

# 进程关闭的脚本
kill_script="$WM_SCRIPTS/kill_process.sh"

if [[ ! -f "$kill_script" ]]; then
    printf "Error: %s does not exist.\n" "$kill_script" >&2
    exit 1
fi

printf "Time to bid farewell to running apps...\n"

# 执行关闭脚本
"$kill_script"

# 播放音频
"$WM_SCRIPTS/play_audio.sh" "service-logout.oga"

printf "All clear! Apps have left the building.\n"
printf "Going dark in %d seconds. Press Ctrl+C to stay alive.\n" "$countdown"

for i in $(seq "$countdown" -1 1); do
    printf "\rT-minus %d seconds... Ctrl+C to cancel." "$i"
    sleep 1
done

printf "\nLights out! Dream of code and bugs.\n"

systemctl poweroff
